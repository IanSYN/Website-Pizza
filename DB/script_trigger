create or replace trigger alerteManqueStock
after update on Ingredient
FOR EACH ROW
DECLARE
	seuilIngr number = 0 ;
    stockIngr number = 0;
    nomIngr String;
    mailGestio String;
    
BEGIN 
	select seuilIngredient into seuilIngr from Alerte A
    inner join Ingredient I on A.idIngredient = I.idIngredient;
    
    select stockIngredient, nomIngredient into stockIngr, nomIngr from Ingredient I
    inner join Alerte A on A.idIngredient = I.idIngredient;
    
    select mailGestionnaire into mailGestio from Gestionnaire G 
    inner join Alerte A on A.idGestionnaire = G.idGestionnaire;
    
if stockIngr < seuilIngr 
then 
	UTL_MAIL.SEND ('sarah-myriam.messaoudi@universite-paris-saclay.fr', mailGestio, 'Stock of the ingredient : ', nomIngr ,' need supplying', 'Warning: ', nomIngr ,' SUPPLIES');
END IF;
END;
